"use strict";function handlersFilter(){isMobile="none"===$(".main-filter").css("display"),$(".prime-filter, .lower-filter").on("change",function(){search()}),$("#user_university").on("change",function(){var e=processInputSelect("user_university");"0"!==e?$.ajax({method:"GET",url:"/filter/get_faculties_by_university_id/"+e,success:function(a){if("ok"===a.status){for(var s=$("#user_faculty").html(""),n=0;n<a.faculties.length;n++)s.append($('<option value="'+a.faculties[n].id+'">'+a.faculties[n].name+"</option>"));$("#user_faculty_container").show()}else console.log('При загрузке факультетов для ВУЗА id="'+e+'" произошла ошибка')},error:function(e){console.log("Ошибка сетевого соединения")}}):$("#user_faculty_container").hide()}),$(".mbl-filter").on("click",function(){$(".listing").hide(),$(".main-filter").show()}),$("#btn-find").on("click",function(e){e.preventDefault(),isMobile&&($(".main-filter").hide(),$(".listing").show()),search()}),$("#load-more").on("click",function(e){e.preventDefault(),loadMore()}),search()}function search(){var e={};e.type=type=processInputSelect("type"),e.priorities=[],$(".priority").each(function(){var a=processInputSelect($(this).attr("id"),!0);a&&e.priorities.push(a)}),e.user_sex=processInputSelect("user_sex"),e.user_age_range=processInputSelect("user_age_range"),e.university_id=processInputSelect("user_university"),e.faculty_id=processInputSelect("user_faculty"),lastForm=e,$.ajax({method:"POST",url:"/filter/ajax",dataType:"json",data:e,success:function(e){if("ok"===e.status){countRecords=e.records.length;var a=$("#listing-content");a.html(""),0===e.records.length?(a.html('<div class="no-records">Поиск не дал результатов</div>'),$("#load-more").hide()):e.records.length<e.recordsCountTotal?$("#load-more").show():$("#load-more").hide();for(var s=0;s<e.records.length;s++){var n=e.records[s],t=null;"find-flat"===type?((t=$('<div class="room-list"></div>')).append($('<img src="'+n.flat_first_photo+'" alt="Room"/>')),t.append($("<h5>"+n.flat_rent_pay+"</h5>").append($("<span> рублей</span>"))),t.append($("<h4></h4>").append($("<span>"+n.user_city+"</span>")).append($("<span>, "+n.flat_address+"</span>"))),t.append($("<p>Сосед: </p>").append($("<span>"+n.user_sex+", </span>")).append($("<span>"+n.user_age+", </span>")).append($("<span>"+n.university_name+"</span>")))):((t=$('<div class="user-list"></div>')).append($('<img src="'+n.user_avatar+'" alt="Room"/>')),t.append($("<h4>"+n.user_first_name+" "+n.user_last_name+"</h4>")),t.append($("<p>Ваш сосед: </p>").append($("<span>"+n.user_sex+", </span>")).append($("<span>"+n.user_age+", </span>")).append($("<span>"+n.university_name+"</span>")))),$('<a href="/profile/view/'+n.user_id+'"></a>').append(t).appendTo(a)}}else alert("При загрузке данных произошла ошибка")},error:function(){alert("Проверьте соединение с Интернетом")}})}function loadMore(){lastForm.offset=countRecords,$.ajax({method:"POST",url:"/filter/ajax",dataType:"json",data:lastForm,success:function(e){if("ok"===e.status){(countRecords+=e.records.length)==e.recordsCountTotal&&$("#load-more").hide();for(var a=$("#listing-content"),s=0;s<e.records.length;s++){var n=e.records[s],t=null;"find-flat"===type?((t=$('<div class="room-list"></div>')).append($('<img src="'+n.flat_first_photo+'" alt="Room"/>')),t.append($("<h5>"+n.flat_rent_pay+"</h5>").append($("<span> рублей</span>"))),t.append($("<h4></h4>").append($("<span>"+n.user_city+"</span>")).append($("<span>, "+n.flat_address+"</span>"))),t.append($("<p>Сосед: </p>").append($("<span>"+n.user_sex+", </span>")).append($("<span>"+n.user_age+", </span>")).append($("<span>"+n.university_name+"</span>")))):((t=$('<div class="user-list"></div>')).append($('<img src="'+n.user_avatar+'" alt="Room"/>')),t.append($("<h4>"+n.user_first_name+" "+n.user_last_name+"</h4>")),t.append($("<p>Ваш сосед: </p>").append($("<span>"+n.user_sex+", </span>")).append($("<span>"+n.user_age+", </span>")).append($("<span>"+n.university_name+"</span>")))),t.appendTo(a)}}else alert("При загрузке данных произошла ошибка")},error:function(){alert("Проверьте соединение с Интернетом")}})}function processInputSelect(e,a){var s,n=$("#"+e+">option");return s=a?null:n.eq(0).val(),n.each(function(e){if($(this).prop("selected")&&(!a||0!==e))return s=$(this).val(),!1}),s}var type=null,countRecords=0,lastForm=null,isMobile=!1;$(document).ready(function(){handlersFilter()});